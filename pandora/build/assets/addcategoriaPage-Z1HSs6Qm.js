import{s as k,p as $,t as _,q,r as b,j as e}from"./index-CuM1UVNz.js";import{u as A,F as V,a as p,b as c,c as l,d,e as m,f as v}from"./form-v5aSno6F.js";import{o as B,c as R,a as M,b as U,d as N}from"./index.esm-mctYN2X9.js";import{b as T,u as w,c as H,d as O}from"./categoriaService-DLty_uvx.js";import{I as g}from"./input-ZDudQbKj.js";import{C as W}from"./checkbox-CnhrIF9M.js";import{S as G,a as J,b as K,c as Q,d as F}from"./select-BYbUwerd.js";import{F as X}from"./FormCard-dpmmvjug.js";import{B as Y}from"./book-open-Cmadd7BL.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./index-BGi3wog7.js";import"./index-CkfEdLBp.js";import"./Combination-CQ9AiL49.js";import"./index-BmPRlYq_.js";import"./button-DvvEsyKI.js";import"./card-D4d4qW_8.js";import"./arrow-left-EuUX28YT.js";const Z=R({nombre:N().required("El nombre es obligatorio").max(255,"El nombre no debe exceder los 255 caracteres"),code:N().required("El código es obligatorio").max(20,"El código no debe exceder los 20 caracteres"),parent:U().nullable().transform(i=>isNaN(i)?null:i),is_active:M().default(!0)});function ve(){const{id:i}=k(),x=$(),u=_(),{toast:n}=q(),t=!!i,s=A({resolver:B(Z),defaultValues:{nombre:"",code:"",parent:"root",is_active:!0}}),{data:o,isLoading:D}=T(i),{data:h,isLoading:ee,isError:f}=w({page_size:100}),j=(h==null?void 0:h.results)||[];b.useEffect(()=>{f&&n({title:"Error al cargar categorías",description:"No se pudieron cargar las categorías padre. Por favor, intenta nuevamente.",variant:"destructive"})},[f,n]),b.useEffect(()=>{t&&o&&s.reset({nombre:o.nombre,code:o.code,parent:o.parent||"root",is_active:o.is_active})},[o,s,t]),b.useEffect(()=>{u.state&&u.state.parentId&&!t&&s.setValue("parent",u.state.parentId)},[u.state,s,t]);const C=H(),E=O(),L=()=>{n({title:"Categoría creada",description:"La categoría ha sido creada exitosamente.",variant:"success"}),x("/basic/categorias")},z=a=>{n({title:"Error al crear",description:`No se pudo crear la categoría: ${a.message||"Error desconocido"}`,variant:"destructive"})},P=()=>{n({title:"Categoría actualizada",description:"La categoría ha sido actualizada exitosamente.",variant:"success"}),x("/basic/categorias")},y=a=>{n({title:"Error al actualizar",description:`No se pudo actualizar la categoría: ${a.message||"Error desconocido"}`,variant:"destructive"})},S=a=>{try{const r={...a,parent:a.parent==="root"||a.parent===""?null:a.parent};t?E.mutate({id:i,data:r},{onSuccess:P,onError:y}):C.mutate(r,{onSuccess:L,onError:z})}catch(r){console.error("Error en formulario:",r),n({title:"Error en el formulario",description:"Hubo un error al procesar el formulario. Por favor, revisa los datos ingresados.",variant:"destructive"})}},I=C.isPending||E.isPending;return e.jsx(X,{title:t?"Editar Categoría":"Nueva Categoría",description:t?"Actualiza la información de la categoría existente":"Completa el formulario para crear una nueva categoría",onSubmit:s.handleSubmit(S),onCancel:()=>x("/basic/categorias"),backLink:"Volver a categorías",isSubmitting:I,icon:e.jsx(Y,{size:24,strokeWidth:1.5}),children:e.jsx(V,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(S),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{control:s.control,name:"nombre",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Nombre"}),e.jsx(d,{children:e.jsx(g,{placeholder:"Nombre de la categoría",...a})}),e.jsx(m,{children:"Nombre descriptivo para la categoría"}),e.jsx(v,{})]})}),e.jsx(p,{control:s.control,name:"code",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Código"}),e.jsx(d,{children:e.jsx(g,{placeholder:"Código",...a})}),e.jsx(m,{children:"Código único para identificar la categoría"}),e.jsx(v,{})]})})]}),e.jsx(p,{control:s.control,name:"parent",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Categoría Padre"}),e.jsx(d,{children:e.jsxs(G,{onValueChange:r=>a.onChange(r),value:a.value?a.value.toString():"root",children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Seleccionar categoría padre (opcional)"})}),e.jsxs(Q,{children:[e.jsx(F,{value:"root",children:"Ninguna (Categoría Raíz)"}),Array.isArray(j)&&j.length>0?j.filter(r=>r&&typeof r=="object"&&r.id).filter(r=>!(t&&r.id===parseInt(i))).map(r=>e.jsxs(F,{value:String(r.id),children:[r.nombre||"Sin nombre"," ",r.path?`(${r.path})`:""]},r.id)):null]})]})}),e.jsx(m,{children:"Selecciona una categoría padre o deja en blanco para una categoría raíz"}),e.jsx(v,{})]})}),e.jsx(p,{control:s.control,name:"is_active",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 border-blue-100",children:[e.jsx(d,{children:e.jsx(W,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(l,{children:"Activo"}),e.jsx(m,{children:"Las categorías inactivas no se mostrarán en listados públicos"})]})]})}),t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(l,{children:"Nivel"}),e.jsx(d,{children:e.jsx(g,{value:(o==null?void 0:o.level)||0,disabled:!0,className:"bg-muted"})}),e.jsx(m,{children:"Nivel jerárquico (calculado automáticamente)"})]}),e.jsxs(c,{children:[e.jsx(l,{children:"Ruta"}),e.jsx(d,{children:e.jsx(g,{value:(o==null?void 0:o.path)||"",disabled:!0,className:"bg-muted font-mono text-sm"})}),e.jsx(m,{children:"Ruta jerárquica completa (calculada automáticamente)"})]})]})]})})})}export{ve as default};

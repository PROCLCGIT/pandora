import{s as q,p as T,q as V,r as x,j as e,X as U}from"./index-CuM1UVNz.js";import{u as D,F as R,a as j,b as z,c as b,d as v,e as h,f as C}from"./form-v5aSno6F.js";import{o as H,c as W,d as S}from"./index.esm-mctYN2X9.js";import{b as X,c as G,d as J,e as K,f as O}from"./zonaService-BJYdhNdV.js";import{u as Q}from"./ciudadService-DirJXudY.js";import{B as F}from"./button-DvvEsyKI.js";import{I as P}from"./input-ZDudQbKj.js";import{T as Y}from"./textarea-DSyUkBxL.js";import{S as ee,a as ae,b as se,c as re,d as oe}from"./select-BYbUwerd.js";import{B as ie}from"./badge-D5I9DsW8.js";import{F as ne}from"./FormCard-dpmmvjug.js";import{P as te}from"./plus-6cwyY5hA.js";import{M as I}from"./map-pin-DwgE0e9D.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./Combination-CQ9AiL49.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";import"./card-D4d4qW_8.js";import"./arrow-left-EuUX28YT.js";const ce=W({nombre:S().required("El nombre es obligatorio").max(50,"El nombre no debe exceder los 50 caracteres"),code:S().required("El código es obligatorio").max(20,"El código no debe exceder los 20 caracteres"),cobertura:S().max(500,"La descripción de cobertura no debe exceder los 500 caracteres")});function Be(){var L;const{id:m}=q(),c=T(),{toast:o}=V(),n=!!m,[i,g]=x.useState([]),[u,N]=x.useState(""),t=D({resolver:H(ce),defaultValues:{nombre:"",code:"",cobertura:""}}),{data:l,isLoading:de}=X(m),{data:p,isLoading:le}=G(m,{enabled:n}),{data:d,isLoading:me}=Q({page_size:100});x.useEffect(()=>{n&&l&&t.reset({nombre:l.nombre,code:l.code,cobertura:l.cobertura||""})},[l,t,n]),x.useEffect(()=>{n&&p&&p.ciudades&&g(p.ciudades)},[p,n]);const E=J(),Z=K(),f=O(),A=a=>{if(i.length>0){const r=i.map(s=>s.id);f.mutate({zona_id:a.id,ciudad_ids:r},{onSuccess:()=>{o({title:"Zona creada",description:"La zona y sus ciudades asociadas han sido creadas exitosamente."}),c("/basic/zonas")},onError:s=>{o({title:"Zona creada, pero hubo errores al asignar ciudades",description:`Se creó la zona pero: ${s.message||"Error al asignar ciudades"}`,variant:"destructive"}),c("/basic/zonas")}})}else o({title:"Zona creada",description:"La zona ha sido creada exitosamente."}),c("/basic/zonas")},B=a=>{o({title:"Error al crear",description:`No se pudo crear la zona: ${a.message||"Error desconocido"}`,variant:"destructive"})},M=a=>{if(i.length>0){const r=i.map(s=>s.id);f.mutate({zona_id:a.id,ciudad_ids:r},{onSuccess:()=>{o({title:"Zona actualizada",description:"La zona y sus ciudades asociadas han sido actualizadas exitosamente."}),c("/basic/zonas")},onError:s=>{o({title:"Zona actualizada, pero hubo errores al asignar ciudades",description:`Se actualizó la zona pero: ${s.message||"Error al asignar ciudades"}`,variant:"destructive"}),c("/basic/zonas")}})}else o({title:"Zona actualizada",description:"La zona ha sido actualizada exitosamente."}),c("/basic/zonas")},$=a=>{o({title:"Error al actualizar",description:`No se pudo actualizar la zona: ${a.message||"Error desconocido"}`,variant:"destructive"})},y=a=>{try{n?Z.mutate({id:m,data:a},{onSuccess:M,onError:$}):E.mutate(a,{onSuccess:A,onError:B})}catch(r){console.error("Error en formulario:",r),o({title:"Error en el formulario",description:"Hubo un error al procesar el formulario. Por favor, revisa los datos ingresados.",variant:"destructive"})}},k=()=>{var r;if(!u)return;const a=(r=d==null?void 0:d.results)==null?void 0:r.find(s=>s.id===parseInt(u));a&&(i.some(s=>s.id===a.id)||g([...i,a])),N("")},w=a=>{g(i.filter(r=>r.id!==a))},_=E.isPending||Z.isPending||f.isPending;return e.jsx(ne,{title:n?"Editar Zona":"Nueva Zona",description:n?"Actualiza la información de la zona existente":"Completa el formulario para crear una nueva zona",onSubmit:t.handleSubmit(y),onCancel:()=>c("/basic/zonas"),backLink:"Volver a zonas",isSubmitting:_,icon:e.jsx(I,{size:24,strokeWidth:1.5}),children:e.jsx(R,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(y),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{control:t.control,name:"nombre",render:({field:a})=>e.jsxs(z,{children:[e.jsx(b,{children:"Nombre"}),e.jsx(v,{children:e.jsx(P,{placeholder:"Nombre de la zona",...a})}),e.jsx(h,{children:"Nombre descriptivo para la zona"}),e.jsx(C,{})]})}),e.jsx(j,{control:t.control,name:"code",render:({field:a})=>e.jsxs(z,{children:[e.jsx(b,{children:"Código"}),e.jsx(v,{children:e.jsx(P,{placeholder:"Código",...a})}),e.jsx(h,{children:"Código único para identificar la zona"}),e.jsx(C,{})]})})]}),e.jsx(j,{control:t.control,name:"cobertura",render:({field:a})=>e.jsxs(z,{children:[e.jsx(b,{children:"Descripción de cobertura"}),e.jsx(v,{children:e.jsx(Y,{placeholder:"Descripción detallada de la cobertura...",className:"min-h-[120px]",...a})}),e.jsx(h,{children:"Describe el área o alcance de cobertura de esta zona"}),e.jsx(C,{})]})}),e.jsxs("div",{className:"border rounded-md p-4 border-blue-100",children:[e.jsx(b,{className:"text-base",children:"Ciudades en esta zona"}),e.jsx(h,{className:"mb-4",children:"Selecciona las ciudades que pertenecen a esta zona geográfica"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(ee,{value:u,onValueChange:N,children:[e.jsx(ae,{children:e.jsx(se,{placeholder:"Seleccionar ciudad"})}),e.jsx(re,{children:(L=d==null?void 0:d.results)==null?void 0:L.map(a=>e.jsxs(oe,{value:a.id.toString(),children:[a.nombre,", ",a.provincia]},a.id))})]})}),e.jsxs(F,{type:"button",variant:"outline",onClick:k,disabled:!u,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Añadir"]})]}),e.jsx("div",{className:"border rounded-md p-3 min-h-[100px] bg-muted/30 border-blue-100",children:i.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground text-sm",children:"No hay ciudades seleccionadas"}):e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(a=>e.jsxs(ie,{variant:"secondary",className:"flex items-center gap-1 py-1.5 pr-1.5",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),a.nombre,", ",a.provincia,e.jsx(F,{type:"button",variant:"ghost",size:"icon",className:"h-4 w-4 rounded-full ml-1 hover:bg-muted",onClick:()=>w(a.id),children:e.jsx(U,{className:"h-2.5 w-2.5"})})]},a.id))})})]})]})})})}export{Be as default};

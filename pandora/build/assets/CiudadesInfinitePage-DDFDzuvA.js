import{p as V,r as h,j as e,q as I,B as P}from"./index-CuM1UVNz.js";import{e as B,a as z}from"./ciudadService-DirJXudY.js";import{B as l}from"./button-DvvEsyKI.js";import{C as g,a as L,b as T,d as $,c as b,e as A}from"./card-D4d4qW_8.js";import{D as O,a as q,b as H,c as R,d as M,e as W}from"./dialog-DY3vMJng.js";import{E as _}from"./eye-DnbWXCAI.js";import{F as G}from"./file-pen-CTd16QCS.js";import{T as J}from"./trash-2-BwIRBH_r.js";import{u as K,P as Q,F as U,S as X}from"./SearchInput-CDkOK910.js";import{S as Y,a as Z,b as ee,c as se,d as F}from"./select-BYbUwerd.js";import{P as ae}from"./plus-6cwyY5hA.js";import{A as re}from"./arrow-left-EuUX28YT.js";import{F as ie}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./Combination-CQ9AiL49.js";import"./input-ZDudQbKj.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";function le({ciudades:x=[],onLoadMore:c,hasNextPage:j,isFetchingNextPage:t,onDelete:f,isDeletePending:p=!1}){const n=V(),[i,o]=h.useState(!1),[r,d]=h.useState(null),m=h.useRef(),v=h.useCallback(a=>{t||(m.current&&m.current.disconnect(),m.current=new IntersectionObserver(u=>{u[0].isIntersecting&&j&&c()}),a&&m.current.observe(a))},[t,j,c]),N=a=>{d(a),o(!0)},C=()=>{f&&r&&f(r.id,{onSettled:()=>{o(!1),d(null)}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map((a,u)=>{const w=u===x.length-1;return e.jsxs(g,{className:"overflow-hidden",ref:w?v:null,children:[e.jsxs(L,{className:"pb-3",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(T,{className:"text-lg truncate",title:a.nombre,children:a.nombre})}),e.jsx($,{children:e.jsx("span",{children:a.provincia})})]}),e.jsx(b,{className:"pb-3",children:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Código:"}),e.jsx("span",{className:"ml-2 text-sm font-mono",children:a.code})]})})}),e.jsxs(A,{className:"border-t bg-muted/50 flex justify-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>n(`/basic/ciudades/${a.id}`),title:"Ver detalles",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>n(`/basic/ciudades/edit/${a.id}`),title:"Editar",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>N(a),title:"Eliminar",className:"text-destructive hover:bg-destructive/10",children:e.jsx(J,{className:"h-4 w-4"})})]})]})]},`${a.id}-${u}`)})}),t&&e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"})}),e.jsx(O,{open:i,onOpenChange:o,children:e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(R,{children:"Confirmar eliminación"}),e.jsxs(M,{children:['¿Estás seguro de que deseas eliminar la ciudad "',r==null?void 0:r.nombre,", ",r==null?void 0:r.provincia,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(W,{children:[e.jsx(l,{variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(l,{variant:"destructive",onClick:C,disabled:p,children:p?"Eliminando...":"Eliminar"})]})]})})]})}function ye(){var D;const x=V(),{toast:c}=I(),[j,t]=h.useState({}),{inputValue:f,setInputValue:p,debouncedValue:n}=K({initialValue:"",delay:500});h.useEffect(()=>{t(s=>({...s,search:n}))},[n]);const{data:i,isLoading:o,isError:r,error:d,fetchNextPage:m,hasNextPage:v,isFetchingNextPage:N,refetch:C}=B({...j,search:n,page_size:12},{onError:s=>{c({title:"Error al cargar datos",description:`No se pudieron cargar las ciudades: ${s.message}`,variant:"destructive"})}}),a=z({onSuccess:s=>{c({title:"Ciudad eliminada",description:"La ciudad ha sido eliminada correctamente."})},onError:s=>{c({title:"Error al eliminar",description:`No se pudo eliminar la ciudad: ${s.message}`,variant:"destructive"})}}),u=s=>{p(s.target.value)},w=s=>{t(S=>({...S,provincia:s==="all"?void 0:s}))},E=()=>{p(""),t({})},y=(i==null?void 0:i.pages.flatMap(s=>s.results))||[],k=(D=i==null?void 0:i.pages[0])!=null&&D.results?Array.from(new Set(i.pages[0].results.map(s=>s.provincia))).sort():[];return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(Q,{icon:e.jsx(P,{size:40,strokeWidth:1.5}),title:"Ciudades con Scroll Infinito",description:"Visualiza las ciudades con paginación dinámica al hacer scroll.",action:{label:"Agregar Ciudad",icon:e.jsx(ae,{className:"h-4 w-4"}),onClick:()=>x("/basic/ciudades/add")}}),e.jsx("div",{className:"mb-4",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>x("/basic/ciudades"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Volver a vista estándar"]})}),e.jsx(U,{title:"Filtros de Búsqueda",description:"Busca ciudades por nombre, código o provincia.",icon:e.jsx(ie,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:E,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(X,{value:f,onChange:u,placeholder:"Buscar por nombre o código...",debouncedValue:n,inputProps:{id:"search"}})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"provincia",className:"text-sm font-medium",children:"Provincia"}),e.jsxs(Y,{onValueChange:w,defaultValue:"all",children:[e.jsx(Z,{id:"provincia",className:"border-blue-200 focus:border-blue-400",children:e.jsx(ee,{placeholder:"Todas las provincias"})}),e.jsxs(se,{children:[e.jsx(F,{value:"all",children:"Todas"}),k.map(s=>e.jsx(F,{value:s,children:s},s))]})]})]})]})}),o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?e.jsx(g,{className:"border-destructive bg-red-50 shadow-md",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Error al cargar datos"}),e.jsx("p",{className:"text-red-600",children:(d==null?void 0:d.message)||"Error desconocido"}),e.jsx(l,{onClick:()=>C(),variant:"outline",className:"border-red-200 text-red-700 hover:bg-red-50",children:"Intentar nuevamente"})]})})}):y.length===0?e.jsx(g,{className:"border-blue-100 shadow-md",children:e.jsxs(b,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"mb-4 text-lg text-blue-800",children:"No se encontraron ciudades con los filtros seleccionados"}),e.jsx(l,{variant:"outline",onClick:E,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Limpiar filtros"})]})}):e.jsx(g,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(b,{className:"p-0",children:e.jsx(le,{ciudades:y,onLoadMore:m,hasNextPage:v,isFetchingNextPage:N,onDelete:(s,S)=>a.mutate(s,S),isDeletePending:a.isPending})})})]})}export{ye as default};

var Ie=t=>{throw TypeError(t)};var he=(t,e,s)=>e.has(t)||Ie("Cannot "+s);var r=(t,e,s)=>(he(t,e,"read from private field"),s?s.call(t):e.get(t)),f=(t,e,s)=>e.has(t)?Ie("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),u=(t,e,s,i)=>(he(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),d=(t,e,s)=>(he(t,e,"access private method"),s);import{J as He,K as Qe,L as x,M as re,Q as te,T as We,W as ue,Y as Ue,Z as Ge,$ as Ye,a0 as Je,a1 as Pe,a2 as ie,a3 as Me,a4 as Ze,r as g,v as $e,a5 as W}from"./index-CuM1UVNz.js";var v,o,Y,m,F,H,U,P,J,$,K,j,A,M,B,c,z,le,de,fe,pe,be,me,ye,Ke,Ae,Xe=(Ae=class extends He{constructor(e,s){super();f(this,c);f(this,v);f(this,o);f(this,Y);f(this,m);f(this,F);f(this,H);f(this,U);f(this,P);f(this,J);f(this,$);f(this,K);f(this,j);f(this,A);f(this,M);f(this,B,new Set);this.options=s,u(this,v,e),u(this,P,null),u(this,U,Qe()),this.options.experimental_prefetchInRender||r(this,U).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,o).addObserver(this),Le(r(this,o),this.options)?d(this,c,z).call(this):this.updateResult(),d(this,c,pe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ve(r(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ve(r(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,d(this,c,be).call(this),d(this,c,me).call(this),r(this,o).removeObserver(this)}setOptions(e){const s=this.options,i=r(this,o);if(this.options=r(this,v).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof x(this.options.enabled,r(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");d(this,c,ye).call(this),r(this,o).setOptions(this.options),s._defaulted&&!re(this.options,s)&&r(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,o),observer:this});const n=this.hasListeners();n&&_e(r(this,o),i,this.options,s)&&d(this,c,z).call(this),this.updateResult(),n&&(r(this,o)!==i||x(this.options.enabled,r(this,o))!==x(s.enabled,r(this,o))||te(this.options.staleTime,r(this,o))!==te(s.staleTime,r(this,o)))&&d(this,c,le).call(this);const a=d(this,c,de).call(this);n&&(r(this,o)!==i||x(this.options.enabled,r(this,o))!==x(s.enabled,r(this,o))||a!==r(this,M))&&d(this,c,fe).call(this,a)}getOptimisticResult(e){const s=r(this,v).getQueryCache().build(r(this,v),e),i=this.createResult(s,e);return tt(this,i)&&(u(this,m,i),u(this,H,this.options),u(this,F,r(this,o).state)),i}getCurrentResult(){return r(this,m)}trackResult(e,s){return new Proxy(e,{get:(i,n)=>(this.trackProp(n),s==null||s(n),Reflect.get(i,n))})}trackProp(e){r(this,B).add(e)}getCurrentQuery(){return r(this,o)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,v).defaultQueryOptions(e),i=r(this,v).getQueryCache().build(r(this,v),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return d(this,c,z).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,m)))}createResult(e,s){var xe;const i=r(this,o),n=this.options,a=r(this,m),h=r(this,F),E=r(this,H),y=e!==i?e.state:r(this,Y),{state:O}=e;let l={...O},N=!1,b;if(s._optimisticResults){const k=this.hasListeners(),X=!k&&Le(e,s),D=k&&_e(e,i,s,n);(X||D)&&(l={...l,...Je(O.data,e.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:V,errorUpdatedAt:q,status:C}=l;b=l.data;let Z=!1;if(s.placeholderData!==void 0&&b===void 0&&C==="pending"){let k;a!=null&&a.isPlaceholderData&&s.placeholderData===(E==null?void 0:E.placeholderData)?(k=a.data,Z=!0):k=typeof s.placeholderData=="function"?s.placeholderData((xe=r(this,K))==null?void 0:xe.state.data,r(this,K)):s.placeholderData,k!==void 0&&(C="success",b=Pe(a==null?void 0:a.data,k,s),N=!0)}if(s.select&&b!==void 0&&!Z)if(a&&b===(h==null?void 0:h.data)&&s.select===r(this,J))b=r(this,$);else try{u(this,J,s.select),b=s.select(b),b=Pe(a==null?void 0:a.data,b,s),u(this,$,b),u(this,P,null)}catch(k){u(this,P,k)}r(this,P)&&(V=r(this,P),b=r(this,$),q=Date.now(),C="error");const ne=l.fetchStatus==="fetching",ae=C==="pending",oe=C==="error",ke=ae&&ne,Se=b!==void 0,S={status:C,fetchStatus:l.fetchStatus,isPending:ae,isSuccess:C==="success",isError:oe,isInitialLoading:ke,isLoading:ke,data:b,dataUpdatedAt:l.dataUpdatedAt,error:V,errorUpdatedAt:q,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>y.dataUpdateCount||l.errorUpdateCount>y.errorUpdateCount,isFetching:ne,isRefetching:ne&&!ae,isLoadingError:oe&&!Se,isPaused:l.fetchStatus==="paused",isPlaceholderData:N,isRefetchError:oe&&Se,isStale:Oe(e,s),refetch:this.refetch,promise:r(this,U)};if(this.options.experimental_prefetchInRender){const k=ee=>{S.status==="error"?ee.reject(S.error):S.data!==void 0&&ee.resolve(S.data)},X=()=>{const ee=u(this,U,S.promise=Qe());k(ee)},D=r(this,U);switch(D.status){case"pending":e.queryHash===i.queryHash&&k(D);break;case"fulfilled":(S.status==="error"||S.data!==D.value)&&X();break;case"rejected":(S.status!=="error"||S.error!==D.reason)&&X();break}}return S}updateResult(){const e=r(this,m),s=this.createResult(r(this,o),this.options);if(u(this,F,r(this,o).state),u(this,H,this.options),r(this,F).data!==void 0&&u(this,K,r(this,o)),re(s,e))return;u(this,m,s);const i=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,a=typeof n=="function"?n():n;if(a==="all"||!a&&!r(this,B).size)return!0;const h=new Set(a??r(this,B));return this.options.throwOnError&&h.add("error"),Object.keys(r(this,m)).some(E=>{const p=E;return r(this,m)[p]!==e[p]&&h.has(p)})};d(this,c,Ke).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&d(this,c,pe).call(this)}},v=new WeakMap,o=new WeakMap,Y=new WeakMap,m=new WeakMap,F=new WeakMap,H=new WeakMap,U=new WeakMap,P=new WeakMap,J=new WeakMap,$=new WeakMap,K=new WeakMap,j=new WeakMap,A=new WeakMap,M=new WeakMap,B=new WeakMap,c=new WeakSet,z=function(e){d(this,c,ye).call(this);let s=r(this,o).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(We)),s},le=function(){d(this,c,be).call(this);const e=te(this.options.staleTime,r(this,o));if(ue||r(this,m).isStale||!Ue(e))return;const i=Ge(r(this,m).dataUpdatedAt,e)+1;u(this,j,setTimeout(()=>{r(this,m).isStale||this.updateResult()},i))},de=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,o)):this.options.refetchInterval)??!1},fe=function(e){d(this,c,me).call(this),u(this,M,e),!(ue||x(this.options.enabled,r(this,o))===!1||!Ue(r(this,M))||r(this,M)===0)&&u(this,A,setInterval(()=>{(this.options.refetchIntervalInBackground||Ye.isFocused())&&d(this,c,z).call(this)},r(this,M)))},pe=function(){d(this,c,le).call(this),d(this,c,fe).call(this,d(this,c,de).call(this))},be=function(){r(this,j)&&(clearTimeout(r(this,j)),u(this,j,void 0))},me=function(){r(this,A)&&(clearInterval(r(this,A)),u(this,A,void 0))},ye=function(){const e=r(this,v).getQueryCache().build(r(this,v),this.options);if(e===r(this,o))return;const s=r(this,o);u(this,o,e),u(this,Y,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ke=function(e){ie.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,m))}),r(this,v).getQueryCache().notify({query:r(this,o),type:"observerResultsUpdated"})})},Ae);function et(t,e){return x(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Le(t,e){return et(t,e)||t.state.data!==void 0&&ve(t,e,e.refetchOnMount)}function ve(t,e,s){if(x(e.enabled,t)!==!1){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&Oe(t,e)}return!1}function _e(t,e,s,i){return(t!==e||x(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&Oe(t,s)}function Oe(t,e){return x(e.enabled,t)!==!1&&t.isStaleByTime(te(e.staleTime,t))}function tt(t,e){return!re(t.getCurrentResult(),e)}var L,_,R,I,Q,se,Re,De,st=(De=class extends He{constructor(e,s){super();f(this,Q);f(this,L);f(this,_);f(this,R);f(this,I);u(this,L,e),this.setOptions(s),this.bindMethods(),d(this,Q,se).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const s=this.options;this.options=r(this,L).defaultMutationOptions(e),re(this.options,s)||r(this,L).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,R),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Me(s.mutationKey)!==Me(this.options.mutationKey)?this.reset():((i=r(this,R))==null?void 0:i.state.status)==="pending"&&r(this,R).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=r(this,R))==null||e.removeObserver(this)}onMutationUpdate(e){d(this,Q,se).call(this),d(this,Q,Re).call(this,e)}getCurrentResult(){return r(this,_)}reset(){var e;(e=r(this,R))==null||e.removeObserver(this),u(this,R,void 0),d(this,Q,se).call(this),d(this,Q,Re).call(this)}mutate(e,s){var i;return u(this,I,s),(i=r(this,R))==null||i.removeObserver(this),u(this,R,r(this,L).getMutationCache().build(r(this,L),this.options)),r(this,R).addObserver(this),r(this,R).execute(e)}},L=new WeakMap,_=new WeakMap,R=new WeakMap,I=new WeakMap,Q=new WeakSet,se=function(){var s;const e=((s=r(this,R))==null?void 0:s.state)??Ze();u(this,_,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},Re=function(e){ie.batch(()=>{var s,i,n,a,h,E,p,y;if(r(this,I)&&this.hasListeners()){const O=r(this,_).variables,l=r(this,_).context;(e==null?void 0:e.type)==="success"?((i=(s=r(this,I)).onSuccess)==null||i.call(s,e.data,O,l),(a=(n=r(this,I)).onSettled)==null||a.call(n,e.data,null,O,l)):(e==null?void 0:e.type)==="error"&&((E=(h=r(this,I)).onError)==null||E.call(h,e.error,O,l),(y=(p=r(this,I)).onSettled)==null||y.call(p,void 0,e.error,O,l))}this.listeners.forEach(O=>{O(r(this,_))})})},De),Be=g.createContext(!1),rt=()=>g.useContext(Be);Be.Provider;function it(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var nt=g.createContext(it()),at=()=>g.useContext(nt);function Ne(t,e){return typeof t=="function"?t(...e):!!t}function ge(){}var ot=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},ht=t=>{g.useEffect(()=>{t.clearReset()},[t])},ct=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:n})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(n&&t.data===void 0||Ne(s,[t.error,i])),ut=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},lt=(t,e)=>t.isLoading&&t.isFetching&&!e,dt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Fe=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function ft(t,e,s){var l,N,b,V,q;const i=$e(),n=rt(),a=at(),h=i.defaultQueryOptions(t);(N=(l=i.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||N.call(l,h),h._optimisticResults=n?"isRestoring":"optimistic",ut(h),ot(h,a),ht(a);const E=!i.getQueryCache().get(h.queryHash),[p]=g.useState(()=>new e(i,h)),y=p.getOptimisticResult(h),O=!n&&t.subscribed!==!1;if(g.useSyncExternalStore(g.useCallback(C=>{const Z=O?p.subscribe(ie.batchCalls(C)):ge;return p.updateResult(),Z},[p,O]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),g.useEffect(()=>{p.setOptions(h)},[h,p]),dt(h,y))throw Fe(h,p,a);if(ct({result:y,errorResetBoundary:a,throwOnError:h.throwOnError,query:i.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw y.error;if((V=(b=i.getDefaultOptions().queries)==null?void 0:b._experimental_afterQuery)==null||V.call(b,h,y),h.experimental_prefetchInRender&&!ue&&lt(y,n)){const C=E?Fe(h,p,a):(q=i.getQueryCache().get(h.queryHash))==null?void 0:q.promise;C==null||C.catch(ge).finally(()=>{p.updateResult()})}return h.notifyOnChangeProps?y:p.trackResult(y)}function gt(t,e){return ft(t,Xe)}function Ct(t,e){const s=$e(),[i]=g.useState(()=>new st(s,t));g.useEffect(()=>{i.setOptions(t)},[i,t]);const n=g.useSyncExternalStore(g.useCallback(h=>i.subscribe(ie.batchCalls(h)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),a=g.useCallback((h,E)=>{i.mutate(h,E).catch(ge)},[i]);if(n.error&&Ne(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:a,mutateAsync:n.mutate}}class pt extends Error{}pt.prototype.name="InvalidTokenError";const G="http://localhost:8000/api",Ce="/auth/refresh/",Ve="/auth/verify/",qe="/auth/logout/",Te="/login";let ce=!1,we=[];const je=(t,e=null)=>{we.forEach(s=>{t?s.reject(t):s.resolve(e)}),we=[]},T=W.create({baseURL:G,timeout:3e4,withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}});let w={hasAccessToken:!1,hasRefreshToken:!1};const bt=()=>({accessToken:w.hasAccessToken?"present-in-httponly-cookie":null,refreshToken:w.hasRefreshToken?"present-in-httponly-cookie":null}),mt=(t,e=null)=>{w.hasAccessToken=!!t,e&&(w.hasRefreshToken=!0)},Ee=()=>{w.hasAccessToken=!1,w.hasRefreshToken=!1,W.post(`${G}${qe}`,{},{withCredentials:!0}).catch(t=>console.warn("Error al hacer logout en el servidor:",t))};T.interceptors.request.use(async t=>(t.headers=t.headers||{},console.debug(`🔄 Request to ${t.url} - Using HttpOnly cookies for auth`),t),t=>Promise.reject(t));const ze=async()=>W.post(`${G}${Ce}`,{},{withCredentials:!0});T.interceptors.response.use(t=>t,async t=>{const e=t.config,s=t.response?t.response.status:null;if(!t.response)return Promise.reject(new Error("No se pudo conectar con el servidor. Verifica tu conexión a Internet."));if(s===401&&!e._retry&&!e.url.includes(Ce)&&!e.url.includes(Ve)){if(ce)try{return await new Promise((i,n)=>{we.push({resolve:i,reject:n})}),T(e)}catch(i){return Promise.reject(i)}ce=!0,e._retry=!0;try{if(console.log("Intentando refrescar token tras error 401..."),(await ze()).status===200)return w.hasAccessToken=!0,je(null,"Token refrescado"),console.log("Token refrescado exitosamente, reintentando solicitud original"),T(e);throw new Error("Fallo al refrescar token")}catch(i){return console.error("Error al refrescar token:",i),je(i,null),Ee(),window.location.href=Te,Promise.reject(i)}finally{ce=!1}}switch(s){case 401:return e.url.includes(Ce)&&(Ee(),window.location.href=Te),Promise.reject(new Error("Tu sesión ha expirado. Por favor, inicia sesión nuevamente."));case 403:return Promise.reject(new Error("No tienes permisos para realizar esta acción."));case 404:return Promise.reject(new Error("El recurso solicitado no existe."));case 422:case 400:return Promise.reject(t);case 500:case 502:case 503:return Promise.reject(new Error("Ha ocurrido un error en el servidor. Por favor, inténtalo más tarde."));default:return Promise.reject(t)}});const Tt={get:(t,e={})=>T.get(t,e),post:(t,e={},s={})=>T.post(t,e,s),put:(t,e={},s={})=>T.put(t,e,s),patch:(t,e={},s={})=>T.patch(t,e,s),delete:(t,e={})=>T.delete(t,e),upload:(t,e,s=null,i={})=>{const n={headers:{"Content-Type":"multipart/form-data"}};return s&&(n.onUploadProgress=s),T.post(t,e,{...n,...i})},download:(t,e,s={})=>T.get(t,{...s,responseType:"blob"}).then(i=>{const n=window.URL.createObjectURL(new Blob([i.data])),a=document.createElement("a");a.href=n,a.setAttribute("download",e),document.body.appendChild(a),a.click(),a.remove()}),setHeaders:(t={})=>{Object.keys(t).forEach(e=>{T.defaults.headers.common[e]=t[e]})},checkAuthStatus:async()=>{try{return(await W.post(`${G}${Ve}`,{},{withCredentials:!0})).status===200?(w.hasAccessToken=!0,w.hasRefreshToken=!0,!0):!1}catch(t){return console.warn("Verificación de token fallida:",t),!1}},refreshTokens:async()=>{try{return(await ze()).status===200?(w.hasAccessToken=!0,w.hasRefreshToken=!0,!0):!1}catch(t){return console.error("Error al refrescar tokens manualmente:",t),!1}},instance:T,getTokens:bt,saveTokens:mt,clearTokens:Ee,logout:async()=>{try{await W.post(`${G}${qe}`,{},{withCredentials:!0})}catch(t){console.warn("Error en logout del servidor:",t)}finally{w.hasAccessToken=!1,w.hasRefreshToken=!1,window.location.href=Te}}};export{Xe as Q,Ct as a,Tt as b,ft as c,gt as u};

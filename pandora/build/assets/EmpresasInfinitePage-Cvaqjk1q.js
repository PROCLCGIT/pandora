import{p as S,q as w,r as d,j as e}from"./index-CuM1UVNz.js";import{u as D,f as v,g as T,a as V,b as k}from"./index-CzaDYwyb.js";import{B as o}from"./button-DvvEsyKI.js";import{T as F,a as z,b,c as B,d as M,e as I}from"./table-B6Cf0HfV.js";import{D as K,a as H,b as L,c as q,d as U,e as A}from"./dialog-DY3vMJng.js";import{c as $,d as _,B as E}from"./empresaClcService-WSwY_hpR.js";import{A as N}from"./arrow-up-down-Bkh7oTm8.js";import{S as G}from"./square-pen-cdigAb40.js";import{T as O}from"./trash-2-BwIRBH_r.js";import{u as W,P as J,F as Q,S as X}from"./SearchInput-CDkOK910.js";import"./input-ZDudQbKj.js";import{C as Y,c as Z}from"./card-D4d4qW_8.js";import{P as ee}from"./plus-6cwyY5hA.js";import{F as se}from"./funnel-DTkdRWcb.js";import"./Combination-CQ9AiL49.js";import"./axios-CTonWHPK.js";function ae({filters:x={},onDelete:m}){var C;const c=S(),{toast:u}=w(),[i,l]=d.useState(null),[p,g]=d.useState([]),{data:a,isLoading:h,isError:j,error:t,refetch:P}=$(x),f=_({onSuccess:s=>{u({title:"Empresa eliminada",description:"La empresa se ha eliminado correctamente."}),m&&m(s),P()},onError:s=>{u({title:"Error al eliminar",description:`No se pudo eliminar la empresa: ${s.message}`,variant:"destructive"})}}),y=[{accessorKey:"code",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Código",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("code")})},{accessorKey:"nombre",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Nombre",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.getValue("nombre")})]})},{accessorKey:"razon_social",header:"Razón Social",cell:({row:s})=>e.jsx("div",{children:s.getValue("razon_social")})},{accessorKey:"ruc",header:"RUC",cell:({row:s})=>e.jsx("div",{children:s.getValue("ruc")})},{accessorKey:"telefono",header:"Teléfono",cell:({row:s})=>e.jsx("div",{children:s.getValue("telefono")||"-"})},{id:"actions",cell:({row:s})=>{const r=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>c(`/basic/empresas/${r.id}`),title:"Editar empresa",children:e.jsx(G,{className:"h-4 w-4 text-blue-600"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>l(r),title:"Eliminar empresa",children:e.jsx(O,{className:"h-4 w-4 text-red-600"})})]})}}],n=D({data:(a==null?void 0:a.results)||[],columns:y,getCoreRowModel:k(),getPaginationRowModel:V(),getSortedRowModel:T(),onSortingChange:g,state:{sorting:p},initialState:{pagination:{pageSize:10}}}),R=()=>{i&&(f.mutate(i.id),l(null))};return h?e.jsx("div",{className:"flex justify-center items-center p-8",children:"Cargando empresas..."}):j?e.jsxs("div",{className:"text-center p-4 text-red-500",children:["Error al cargar empresas: ",t.message]}):(C=a==null?void 0:a.results)!=null&&C.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(F,{children:[e.jsx(z,{children:n.getHeaderGroups().map(s=>e.jsx(b,{children:s.headers.map(r=>e.jsx(B,{children:r.isPlaceholder?null:v(r.column.columnDef.header,r.getContext())},r.id))},s.id))}),e.jsx(M,{children:n.getRowModel().rows.map(s=>e.jsx(b,{className:"cursor-pointer hover:bg-blue-50",onClick:()=>c(`/basic/empresas/${s.original.id}`),children:s.getVisibleCells().map(r=>e.jsx(I,{children:v(r.column.columnDef.cell,r.getContext())},r.id))},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Total: ",(a==null?void 0:a.count)||0," empresas"]}),e.jsxs("div",{className:"flex items-center space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Página ",n.getState().pagination.pageIndex+1," de"," ",n.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),children:"<"}),e.jsx(o,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),children:">"})]})]})]}),e.jsx(K,{open:!!i,onOpenChange:s=>!s&&l(null),children:e.jsxs(H,{children:[e.jsxs(L,{children:[e.jsx(q,{children:"Confirmar eliminación"}),e.jsxs(U,{children:['¿Está seguro de que desea eliminar la empresa "',i==null?void 0:i.nombre,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(A,{children:[e.jsx(o,{variant:"outline",onClick:()=>l(null),children:"Cancelar"}),e.jsx(o,{variant:"destructive",onClick:R,disabled:f.isPending,children:f.isPending?"Eliminando...":"Eliminar"})]})]})})]}):e.jsx("div",{className:"text-center p-8 text-gray-500",children:"No se encontraron empresas con los criterios especificados."})}function Ce(){const x=S();w();const[m,c]=d.useState({}),{inputValue:u,setInputValue:i,debouncedValue:l}=W({initialValue:"",delay:500});d.useEffect(()=>{c(t=>({...t,search:l}))},[l]);const[p,g]=d.useState(0),a=t=>{i(t.target.value)},h=()=>{i(""),c({}),g(t=>t+1)},j=()=>{g(t=>t+1)};return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(J,{icon:e.jsx(E,{size:40,strokeWidth:1.5}),title:"Empresas CLC",description:"Gestión de empresas del grupo CLC.",action:{label:"Agregar Empresa",icon:e.jsx(ee,{className:"h-4 w-4"}),onClick:()=>x("/basic/empresas/add")}}),e.jsx(Q,{title:"Filtros de Búsqueda",description:"Busca empresas por nombre, razón social, RUC o código.",icon:e.jsx(se,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:h,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(X,{value:u,onChange:a,placeholder:"Buscar por nombre, razón social, RUC o código...",debouncedValue:l,inputProps:{id:"search"}})]})})}),e.jsx(Y,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(Z,{className:"p-0",children:e.jsx(ae,{filters:m,onDelete:j},p)})})]})}export{Ce as default};

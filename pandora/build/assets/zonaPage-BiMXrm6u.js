import{p as F,q as V,r as o,j as a}from"./index-CuM1UVNz.js";import{u as Z,a as A}from"./zonaService-BJYdhNdV.js";import{u as w,P as M,F as $,S as q}from"./SearchInput-CDkOK910.js";import{B as O}from"./badge-D5I9DsW8.js";import{D as T,a as I,b as H,c as L,d as R,e as G}from"./dialog-DY3vMJng.js";import{B as D}from"./button-DvvEsyKI.js";import{D as W,A as _}from"./ActionButtons-CaN9juX7.js";import{P as J}from"./plus-6cwyY5hA.js";import{M as v}from"./map-pin-DwgE0e9D.js";import{F as K}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./card-D4d4qW_8.js";import"./input-ZDudQbKj.js";import"./Combination-CQ9AiL49.js";import"./table-B6Cf0HfV.js";import"./tooltip-MLxQ3M63.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./eye-DnbWXCAI.js";import"./file-pen-CTd16QCS.js";import"./trash-2-BwIRBH_r.js";function fe(){const c=F(),{toast:l}=V(),[t,h]=o.useState({}),[C,i]=o.useState(!1),[r,g]=o.useState(null),[x,d]=o.useState(1),u=10,{inputValue:N,setInputValue:b,debouncedValue:n}=w({initialValue:"",delay:500});o.useEffect(()=>{d(1),h(e=>({...e,search:n}))},[n]),o.useEffect(()=>{(t&&Object.keys(t).length>1||Object.keys(t).length===1&&!t.search)&&d(1)},[t]);const{data:s,isLoading:E,isError:P,error:m,refetch:f}=Z({...t,search:n,page:x,page_size:u},{keepPreviousData:!0,onError:e=>{l({title:"Error al cargar datos",description:`No se pudieron cargar las zonas: ${e.message}`,variant:"destructive"})}}),p=A({onSuccess:()=>{l({title:"Zona eliminada",description:r?`La zona "${r.nombre}" ha sido eliminada correctamente.`:"La zona ha sido eliminada correctamente."})},onError:e=>{l({title:"Error al eliminar",description:`No se pudo eliminar la zona: ${e.message}`,variant:"destructive"})}}),S=e=>{b(e.target.value)},k=e=>{g(e),i(!0)},B=()=>{p.mutate(r.id,{onSettled:()=>{i(!1),g(null),f()}})},y=(e,j=100)=>e?e.length>j?`${e.substring(0,j)}...`:e:"",z=[{header:"Nombre",accessor:"nombre",cell:e=>a.jsxs("div",{className:"font-medium flex items-center text-gray-800",children:[a.jsx(v,{className:"h-4 w-4 mr-2 text-blue-500 flex-shrink-0"}),a.jsx("span",{className:"truncate",title:e.nombre,children:e.nombre})]})},{header:"Código",accessor:"code",cell:e=>a.jsx(O,{variant:"outline",className:"font-mono bg-blue-50 text-blue-800 border-blue-200",children:e.code||"N/A"})},{header:"Cobertura",accessor:"cobertura",cell:e=>e.cobertura?a.jsx("span",{title:e.cobertura,children:y(e.cobertura,60)}):a.jsx("span",{className:"text-muted-foreground text-sm italic",children:"Sin descripción"})},{header:"Acciones",accessor:"id",style:{textAlign:"center",width:"7rem"},cell:e=>a.jsx(_,{onView:()=>c(`/basic/zonas/${e.id}`),onEdit:()=>c(`/basic/zonas/edit/${e.id}`),onDelete:()=>k(e)})}];return a.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[a.jsx(M,{icon:a.jsx(v,{size:40,strokeWidth:1.5}),title:"Gestión de Zonas",description:"Administra las zonas geográficas de operación.",action:{label:"Agregar Zona",icon:a.jsx(J,{className:"h-4 w-4"}),onClick:()=>c("/basic/zonas/add")}}),a.jsx($,{title:"Filtros de Búsqueda",description:"Busca zonas por nombre, código o cobertura.",icon:a.jsx(K,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:()=>{b(""),h({})},children:a.jsxs("div",{className:"flex flex-col space-y-1.5",children:[a.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),a.jsx(q,{value:N,onChange:S,placeholder:"Buscar por nombre, código o cobertura...",debouncedValue:n,inputProps:{id:"search"}})]})}),a.jsx(W,{columns:z,data:s==null?void 0:s.results,isLoading:E,isError:P,errorMessage:m==null?void 0:m.message,onRetry:f,emptyMessage:"No se encontraron zonas que coincidan con la búsqueda.",pagination:{currentPage:x,totalPages:Math.ceil(((s==null?void 0:s.count)||0)/u),totalItems:(s==null?void 0:s.count)||0,pageSize:u,onPageChange:d}}),a.jsx(T,{open:C,onOpenChange:i,children:a.jsxs(I,{children:[a.jsxs(H,{children:[a.jsx(L,{children:"Confirmar eliminación"}),a.jsxs(R,{children:['¿Estás seguro de que deseas eliminar la zona "',r==null?void 0:r.nombre,'"? Esta acción no se puede deshacer.']})]}),a.jsxs(G,{children:[a.jsx(D,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),a.jsx(D,{variant:"destructive",onClick:B,disabled:p.isPending,children:p.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{fe as default};

import{p as q,q as $,r,j as e,B as v}from"./index-CuM1UVNz.js";import{u as z,a as I}from"./ciudadService-DirJXudY.js";import{u as M,P as O,F as T,S as L}from"./SearchInput-CDkOK910.js";import{B as H}from"./badge-D5I9DsW8.js";import{B as g}from"./button-DvvEsyKI.js";import{D as R,a as G,b as W,c as _,d as J,e as K}from"./dialog-DY3vMJng.js";import{S as Q,a as U,b as X,c as Y,d as C}from"./select-BYbUwerd.js";import{D as Z,A as ee}from"./ActionButtons-CaN9juX7.js";import{P as se}from"./plus-6cwyY5hA.js";import{F as ae}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./card-D4d4qW_8.js";import"./input-ZDudQbKj.js";import"./Combination-CQ9AiL49.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";import"./table-B6Cf0HfV.js";import"./tooltip-MLxQ3M63.js";import"./eye-DnbWXCAI.js";import"./file-pen-CTd16QCS.js";import"./trash-2-BwIRBH_r.js";function Ee(){const t=q(),{toast:l}=$(),[o,d]=r.useState({}),[N,n]=r.useState(!1),[i,x]=r.useState(null),[b,u]=r.useState(1),m=10,{inputValue:S,setInputValue:f,debouncedValue:c}=M({initialValue:"",delay:500});r.useEffect(()=>{u(1),d(s=>({...s,search:c}))},[c]),r.useEffect(()=>{Object.entries(o).some(([A,w])=>A!=="search"&&w!==void 0)&&u(1)},[o]);const{data:a,isLoading:D,isError:P,error:p,refetch:j}=z({...o,search:c,page:b,page_size:m},{keepPreviousData:!0,onError:s=>{l({title:"Error al cargar datos",description:`No se pudieron cargar las ciudades: ${s.message}`,variant:"destructive"})}}),h=I({onSuccess:()=>{l({title:"Ciudad eliminada",description:i?`La ciudad "${i.nombre}" ha sido eliminada correctamente.`:"La ciudad ha sido eliminada correctamente."})},onError:s=>{l({title:"Error al eliminar",description:`No se pudo eliminar la ciudad: ${s.message}`,variant:"destructive"})}}),E=s=>{f(s.target.value)},V=s=>{d({...o,provincia:s==="all"?void 0:s})},B=s=>{x(s),n(!0)},F=()=>{h.mutate(i.id,{onSettled:()=>{n(!1),x(null),j()}})},y=a!=null&&a.results?Array.from(new Set(a.results.map(s=>s.provincia))).sort():[],k=[{header:"Nombre",accessor:"nombre",cell:s=>e.jsxs("div",{className:"font-medium flex items-center text-gray-800",children:[e.jsx(v,{className:"h-4 w-4 mr-2 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.nombre,children:s.nombre})]})},{header:"Provincia",accessor:"provincia",cell:s=>e.jsx("span",{className:"text-gray-700",children:s.provincia})},{header:"Código",accessor:"code",cell:s=>e.jsx(H,{variant:"outline",className:"font-mono bg-blue-50 text-blue-800 border-blue-200",children:s.code||"N/A"})},{header:"Acciones",accessor:"id",style:{textAlign:"center",width:"7rem"},cell:s=>e.jsx(ee,{onView:()=>t(`/basic/ciudades/${s.id}`),onEdit:()=>t(`/basic/ciudades/edit/${s.id}`),onDelete:()=>B(s)})}];return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(O,{icon:e.jsx(v,{size:40,strokeWidth:1.5}),title:"Gestión de Ciudades",description:"Administra las ciudades donde se ofrecen servicios.",action:{label:"Agregar Ciudad",icon:e.jsx(se,{className:"h-4 w-4"}),onClick:()=>t("/basic/ciudades/add")}}),e.jsx(T,{title:"Filtros de Búsqueda",description:"Busca ciudades por nombre, código o provincia.",icon:e.jsx(ae,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:()=>{f(""),d({})},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(L,{value:S,onChange:E,placeholder:"Buscar por nombre o código...",debouncedValue:c,inputProps:{id:"search"}})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"provincia",className:"text-sm font-medium",children:"Provincia"}),e.jsxs(Q,{onValueChange:V,defaultValue:"all",children:[e.jsx(U,{id:"provincia",className:"h-9 border-blue-200 focus:border-blue-400",children:e.jsx(X,{placeholder:"Todas las provincias"})}),e.jsxs(Y,{children:[e.jsx(C,{value:"all",children:"Todas"}),y.map(s=>e.jsx(C,{value:s,children:s},s))]})]})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>t("/basic/ciudades/infinite"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Ver con paginación infinita"})}),e.jsx(Z,{columns:k,data:a==null?void 0:a.results,isLoading:D,isError:P,errorMessage:p==null?void 0:p.message,onRetry:j,emptyMessage:"No se encontraron ciudades que coincidan con la búsqueda.",pagination:{currentPage:b,totalPages:Math.ceil(((a==null?void 0:a.count)||0)/m),totalItems:(a==null?void 0:a.count)||0,pageSize:m,onPageChange:u}}),e.jsx(R,{open:N,onOpenChange:n,children:e.jsxs(G,{children:[e.jsxs(W,{children:[e.jsx(_,{children:"Confirmar eliminación"}),e.jsxs(J,{children:['¿Estás seguro de que deseas eliminar la ciudad "',i==null?void 0:i.nombre,", ",i==null?void 0:i.provincia,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(K,{children:[e.jsx(g,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(g,{variant:"destructive",onClick:F,disabled:h.isPending,children:h.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{Ee as default};

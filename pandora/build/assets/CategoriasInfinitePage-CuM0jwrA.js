import{p as V,q as I,r as p,j as e}from"./index-CuM1UVNz.js";import{f as P,a as z}from"./categoriaService-DLty_uvx.js";import{B as h}from"./button-DvvEsyKI.js";import{B as S}from"./badge-D5I9DsW8.js";import{T as A,a as R,b as w,c as d,d as _,e as m}from"./table-B6Cf0HfV.js";import{C as j,c as v,a as L,b as D,d as H,e as $}from"./card-D4d4qW_8.js";import{E as M}from"./eye-DnbWXCAI.js";import{F as q}from"./file-pen-CTd16QCS.js";import{T as O}from"./trash-2-BwIRBH_r.js";import{u as K,P as W,F as G,S as J}from"./SearchInput-CDkOK910.js";import"./input-ZDudQbKj.js";import{S as y,a as E,b as T,c as F,d as t}from"./select-BYbUwerd.js";import{P as Q}from"./plus-6cwyY5hA.js";import{B as U}from"./book-open-Cmadd7BL.js";import{A as X}from"./arrow-left-EuUX28YT.js";import{F as Y}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./Combination-CQ9AiL49.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";function Z({filters:g={},onDelete:r}){const o=V(),{toast:f}=I(),i=p.useRef(null),{data:l,isLoading:N,isError:b,error:x,fetchNextPage:u,hasNextPage:n,isFetchingNextPage:c}=P(g),C=z({onSuccess:s=>{f({title:"Categoría eliminada",description:"La categoría ha sido eliminada correctamente."}),r&&r(s)},onError:s=>{f({title:"Error al eliminar",description:`No se pudo eliminar la categoría: ${s.message}`,variant:"destructive"})}});p.useEffect(()=>{if(!i.current||!n)return;const s=new IntersectionObserver(B=>{B[0].isIntersecting&&n&&!c&&u()},{threshold:.5});return s.observe(i.current),()=>{i.current&&s.unobserve(i.current)}},[i,n,u,c]);const a=s=>{window.confirm(`¿Estás seguro de eliminar la categoría "${s.nombre}"?`)&&C.mutate(s.id)};if(N&&!l)return e.jsx(j,{children:e.jsx(v,{className:"py-10",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})})});if(b)return e.jsxs(j,{className:"border-destructive",children:[e.jsxs(L,{children:[e.jsx(D,{children:"Error al cargar datos"}),e.jsx(H,{children:"No se pudieron cargar las categorías"})]}),e.jsx(v,{children:e.jsx("p",{children:(x==null?void 0:x.message)||"Error desconocido"})}),e.jsx($,{children:e.jsx(h,{onClick:()=>window.location.reload(),variant:"outline",children:"Intentar nuevamente"})})]});if(!l||!l.pages||l.pages.length===0||!l.pages[0].results.length)return e.jsx(j,{children:e.jsx(v,{className:"py-10",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"No se encontraron categorías con los filtros aplicados"})})});const k=l.pages.flatMap(s=>s.results);return e.jsx(j,{children:e.jsxs(v,{className:"p-0",children:[e.jsxs(A,{children:[e.jsx(R,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Nombre"}),e.jsx(d,{children:"Código"}),e.jsx(d,{children:"Nivel"}),e.jsx(d,{children:"Ruta"}),e.jsx(d,{children:"Estado"}),e.jsx(d,{className:"text-right",children:"Acciones"})]})}),e.jsx(_,{children:k.map(s=>e.jsxs(w,{children:[e.jsx(m,{className:"font-medium",children:s.nombre}),e.jsx(m,{children:s.code}),e.jsx(m,{children:s.level}),e.jsx(m,{children:e.jsx("span",{className:"text-xs font-mono bg-muted p-1 rounded",children:s.path})}),e.jsx(m,{children:s.is_active?e.jsx(S,{className:"bg-green-500",children:"Activo"}):e.jsx(S,{variant:"secondary",children:"Inactivo"})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-1",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>o(`/basic/categorias/${s.id}`),title:"Ver detalles",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>o(`/basic/categorias/edit/${s.id}`),title:"Editar",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>a(s),title:"Eliminar",className:"text-destructive hover:bg-destructive/10",children:e.jsx(O,{className:"h-4 w-4"})})]})})]},s.id))})]}),n&&e.jsx("div",{ref:i,className:"py-4 text-center",children:c?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mx-auto"}):e.jsx(h,{variant:"ghost",onClick:()=>u(),disabled:c,children:"Cargar más"})})]})})}function Ce(){const g=V();I();const[r,o]=p.useState({is_active:void 0,level:void 0}),{inputValue:f,setInputValue:i,debouncedValue:l}=K({initialValue:"",delay:500});p.useEffect(()=>{o(a=>({...a,search:l}))},[l]);const[N,b]=p.useState(0),x=a=>{i(a.target.value)},u=a=>{o({...r,is_active:a==="all"?void 0:a==="true"})},n=a=>{o({...r,level:a==="all"?void 0:parseInt(a)})},c=()=>{b(a=>a+1)},C=()=>{i(""),o({is_active:void 0,level:void 0}),b(a=>a+1)};return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(W,{icon:e.jsx(U,{size:40,strokeWidth:1.5}),title:"Categorías con Scroll Infinito",description:"Visualiza las categorías con paginación dinámica al hacer scroll.",action:{label:"Agregar Categoría",icon:e.jsx(Q,{className:"h-4 w-4"}),onClick:()=>g("/basic/categorias/add")}}),e.jsx("div",{className:"mb-4",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>g("/basic/categorias"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Volver a vista estándar"]})}),e.jsx(G,{title:"Filtros de Búsqueda",description:"Busca categorías por nombre, código, nivel o estado.",icon:e.jsx(Y,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:C,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(J,{value:f,onChange:x,placeholder:"Buscar por nombre o código...",debouncedValue:l,inputProps:{id:"search"}})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"status",className:"text-sm font-medium",children:"Estado"}),e.jsxs(y,{onValueChange:u,value:r.is_active===void 0?"all":r.is_active.toString(),children:[e.jsx(E,{id:"status",className:"border-blue-200 focus:border-blue-400",children:e.jsx(T,{placeholder:"Todos los estados"})}),e.jsxs(F,{children:[e.jsx(t,{value:"all",children:"Todos"}),e.jsx(t,{value:"true",children:"Activo"}),e.jsx(t,{value:"false",children:"Inactivo"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"level",className:"text-sm font-medium",children:"Nivel"}),e.jsxs(y,{onValueChange:n,value:r.level===void 0?"all":r.level.toString(),children:[e.jsx(E,{id:"level",className:"border-blue-200 focus:border-blue-400",children:e.jsx(T,{placeholder:"Todos los niveles"})}),e.jsxs(F,{children:[e.jsx(t,{value:"all",children:"Todos"}),e.jsx(t,{value:"0",children:"Nivel 0 (Raíz)"}),e.jsx(t,{value:"1",children:"Nivel 1"}),e.jsx(t,{value:"2",children:"Nivel 2"}),e.jsx(t,{value:"3",children:"Nivel 3"})]})]})]})]})}),e.jsx(j,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(v,{className:"p-0",children:e.jsx(Z,{filters:r,onDelete:c},N)})})]})}export{Ce as default};

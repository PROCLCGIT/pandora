import{p as k,r as u,j as e,q as V}from"./index-CuM1UVNz.js";import{g as Z,a as I}from"./zonaService-BJYdhNdV.js";import{B as i}from"./button-DvvEsyKI.js";import{B as S}from"./badge-D5I9DsW8.js";import{C,a as P,b as B,d as $,c as w,e as T}from"./card-D4d4qW_8.js";import{D as L,a as M,b as O,c as q,d as A,e as H}from"./dialog-DY3vMJng.js";import{M as F}from"./map-pin-DwgE0e9D.js";import{E as R}from"./eye-DnbWXCAI.js";import{F as W}from"./file-pen-CTd16QCS.js";import{T as _}from"./trash-2-BwIRBH_r.js";import{u as G,P as J,F as K,S as Q}from"./SearchInput-CDkOK910.js";import{P as U}from"./plus-6cwyY5hA.js";import{A as X}from"./arrow-left-EuUX28YT.js";import{F as Y}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./Combination-CQ9AiL49.js";import"./input-ZDudQbKj.js";function z({zonas:h=[],onLoadMore:n,hasNextPage:j,isFetchingNextPage:c,onDelete:b,isDeletePending:x=!1}){const t=k(),[p,o]=u.useState(!1),[l,d]=u.useState(null),m=u.useRef(),E=u.useCallback(s=>{c||(m.current&&m.current.disconnect(),m.current=new IntersectionObserver(r=>{r[0].isIntersecting&&j&&n()}),s&&m.current.observe(s))},[c,j,n]),D=(s,r=100)=>s?s.length>r?`${s.substring(0,r)}...`:s:"",y=s=>{d(s),o(!0)},v=()=>{b&&l&&b(l.id,{onSettled:()=>{o(!1),d(null)}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map((s,r)=>{const N=r===h.length-1;return e.jsxs(C,{className:"overflow-hidden",ref:N?E:null,children:[e.jsxs(P,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(B,{className:"text-lg truncate flex items-center",title:s.nombre,children:[e.jsx(F,{className:"h-4 w-4 mr-2 text-muted-foreground"}),s.nombre]}),e.jsx(S,{variant:"outline",children:s.code})]}),s.ciudades&&s.ciudades.length>0&&e.jsxs($,{children:[s.ciudades.length," ",s.ciudades.length===1?"ciudad":"ciudades"]})]}),e.jsx(w,{className:"pb-3",children:e.jsxs("div",{className:"space-y-2",children:[s.cobertura?e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-3",title:s.cobertura,children:D(s.cobertura,150)}):e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"Sin descripción de cobertura"}),s.ciudades&&s.ciudades.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.ciudades.slice(0,3).map(f=>e.jsx(S,{variant:"secondary",className:"text-xs",children:f.nombre},f.id)),s.ciudades.length>3&&e.jsxs(S,{variant:"outline",className:"text-xs",children:["+",s.ciudades.length-3," más"]})]})]})}),e.jsx(T,{className:"border-t bg-muted/50 flex justify-end",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>t(`/basic/zonas/${s.id}`),title:"Ver detalles",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>t(`/basic/zonas/edit/${s.id}`),title:"Editar",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>y(s),title:"Eliminar",className:"text-destructive hover:bg-destructive/10",children:e.jsx(_,{className:"h-4 w-4"})})]})})]},`${s.id}-${r}`)})}),c&&e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"})}),e.jsx(L,{open:p,onOpenChange:o,children:e.jsxs(M,{children:[e.jsxs(O,{children:[e.jsx(q,{children:"Confirmar eliminación"}),e.jsxs(A,{children:['¿Estás seguro de que deseas eliminar la zona "',l==null?void 0:l.nombre,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(H,{children:[e.jsx(i,{variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(i,{variant:"destructive",onClick:v,disabled:x,children:x?"Eliminando...":"Eliminar"})]})]})})]})}function je(){var f;const h=k(),{toast:n}=V(),[j,c]=u.useState({}),{inputValue:b,setInputValue:x,debouncedValue:t}=G({initialValue:"",delay:500});u.useEffect(()=>{c(a=>({...a,search:t}))},[t]);const{data:p,isLoading:o,isError:l,error:d,fetchNextPage:m,hasNextPage:E,isFetchingNextPage:D,refetch:y}=Z({...j,search:t,page_size:12},{onError:a=>{n({title:"Error al cargar datos",description:`No se pudieron cargar las zonas: ${a.message}`,variant:"destructive"})}}),v=I({onSuccess:a=>{n({title:"Zona eliminada",description:"La zona ha sido eliminada correctamente."})},onError:a=>{n({title:"Error al eliminar",description:`No se pudo eliminar la zona: ${a.message}`,variant:"destructive"})}}),s=a=>{x(a.target.value)},r=()=>{x(""),c({})},N=((f=p==null?void 0:p.pages)==null?void 0:f.flatMap(a=>a.results.map(g=>g.ciudades?g:{...g,ciudades:[]})))||[];return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(J,{icon:e.jsx(F,{size:40,strokeWidth:1.5}),title:"Zonas con Scroll Infinito",description:"Visualiza las zonas geográficas con paginación dinámica al hacer scroll.",action:{label:"Agregar Zona",icon:e.jsx(U,{className:"h-4 w-4"}),onClick:()=>h("/basic/zonas/add")}}),e.jsx("div",{className:"mb-4",children:e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>h("/basic/zonas"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Volver a vista estándar"]})}),e.jsx(K,{title:"Filtros de Búsqueda",description:"Busca zonas por nombre, código o cobertura.",icon:e.jsx(Y,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:r,children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(Q,{value:b,onChange:s,placeholder:"Buscar por nombre, código o cobertura...",debouncedValue:t,inputProps:{id:"search"}})]})})}),o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):l?e.jsx(C,{className:"border-destructive bg-red-50 shadow-md",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Error al cargar datos"}),e.jsx("p",{className:"text-red-600",children:(d==null?void 0:d.message)||"Error desconocido"}),e.jsx(i,{onClick:()=>y(),variant:"outline",className:"border-red-200 text-red-700 hover:bg-red-50",children:"Intentar nuevamente"})]})})}):N.length===0?e.jsx(C,{className:"border-blue-100 shadow-md",children:e.jsxs(w,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"mb-4 text-lg text-blue-800",children:"No se encontraron zonas con los filtros seleccionados"}),e.jsx(i,{variant:"outline",onClick:r,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Limpiar filtros"})]})}):e.jsx(C,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(w,{className:"p-0",children:e.jsx(z,{zonas:N,onLoadMore:m,hasNextPage:E,isFetchingNextPage:D,onDelete:(a,g)=>v.mutate(a,g),isDeletePending:v.isPending})})})]})}export{je as default};

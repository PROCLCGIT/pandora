import{p as S,q as w,r as d,j as e}from"./index-CuM1UVNz.js";import{u as k,f as C,g as F,a as R,b as V}from"./index-CzaDYwyb.js";import{B as c}from"./button-DvvEsyKI.js";import{T as M,a as B,b as N,c as I,d as H,e as q}from"./table-B6Cf0HfV.js";import{D as z,a as K,b as L,c as A,d as G,e as $}from"./dialog-DY3vMJng.js";import{c as _,d as O}from"./procedenciaService-DWQpBnYH.js";import{A as P}from"./arrow-up-down-Bkh7oTm8.js";import{G as D}from"./globe-FYGSDlcS.js";import{S as U}from"./square-pen-cdigAb40.js";import{T as W}from"./trash-2-BwIRBH_r.js";import{u as J,P as Q,F as X,S as Y}from"./SearchInput-CDkOK910.js";import{C as Z,c as ee}from"./card-D4d4qW_8.js";import{P as se}from"./plus-6cwyY5hA.js";import{F as ae}from"./funnel-DTkdRWcb.js";import"./Combination-CQ9AiL49.js";import"./axios-CTonWHPK.js";import"./input-ZDudQbKj.js";function ie({filters:u={},onDelete:m}){var v;const l=S(),{toast:g}=w(),[r,n]=d.useState(null),[p,x]=d.useState([]),{data:i,isLoading:h,isError:j,error:t,refetch:y}=_(u),f=O({onSuccess:s=>{g({title:"Procedencia eliminada",description:"La procedencia se ha eliminado correctamente."}),m&&m(s),y()},onError:s=>{g({title:"Error al eliminar",description:`No se pudo eliminar la procedencia: ${s.message}`,variant:"destructive"})}}),E=[{accessorKey:"code",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Código",e.jsx(P,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("code")})},{accessorKey:"nombre",header:({column:s})=>e.jsxs(c,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Nombre",e.jsx(P,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.getValue("nombre")})]})},{accessorKey:"created_at",header:"Fecha de Creación",cell:({row:s})=>{const a=new Date(s.original.created_at);return e.jsx("div",{children:a.toLocaleDateString()})}},{id:"actions",cell:({row:s})=>{const a=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:b=>{b.stopPropagation(),l(`/basic/procedencias/${a.id}`)},title:"Editar procedencia",children:e.jsx(U,{className:"h-4 w-4 text-blue-600"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:b=>{b.stopPropagation(),n(a)},title:"Eliminar procedencia",children:e.jsx(W,{className:"h-4 w-4 text-red-600"})})]})}}],o=k({data:(i==null?void 0:i.results)||[],columns:E,getCoreRowModel:V(),getPaginationRowModel:R(),getSortedRowModel:F(),onSortingChange:x,state:{sorting:p},initialState:{pagination:{pageSize:10}}}),T=()=>{r&&(f.mutate(r.id),n(null))};return h?e.jsx("div",{className:"flex justify-center items-center p-8",children:"Cargando procedencias..."}):j?e.jsxs("div",{className:"text-center p-4 text-red-500",children:["Error al cargar procedencias: ",t.message]}):(v=i==null?void 0:i.results)!=null&&v.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(M,{children:[e.jsx(B,{children:o.getHeaderGroups().map(s=>e.jsx(N,{children:s.headers.map(a=>e.jsx(I,{children:a.isPlaceholder?null:C(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),e.jsx(H,{children:o.getRowModel().rows.map(s=>e.jsx(N,{className:"cursor-pointer hover:bg-blue-50",onClick:()=>l(`/basic/procedencias/${s.original.id}`),children:s.getVisibleCells().map(a=>e.jsx(q,{children:C(a.column.columnDef.cell,a.getContext())},a.id))},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Total: ",(i==null?void 0:i.count)||0," procedencias"]}),e.jsxs("div",{className:"flex items-center space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Página ",o.getState().pagination.pageIndex+1," de"," ",o.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:"<"}),e.jsx(c,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:">"})]})]})]}),e.jsx(z,{open:!!r,onOpenChange:s=>!s&&n(null),children:e.jsxs(K,{children:[e.jsxs(L,{children:[e.jsx(A,{children:"Confirmar eliminación"}),e.jsxs(G,{children:['¿Está seguro de que desea eliminar la procedencia "',r==null?void 0:r.nombre,'"? Esta acción no se puede deshacer.']})]}),e.jsxs($,{children:[e.jsx(c,{variant:"outline",onClick:()=>n(null),children:"Cancelar"}),e.jsx(c,{variant:"destructive",onClick:T,disabled:f.isPending,children:f.isPending?"Eliminando...":"Eliminar"})]})]})})]}):e.jsx("div",{className:"text-center p-8 text-gray-500",children:"No se encontraron procedencias con los criterios especificados."})}function Ce(){const u=S();w();const[m,l]=d.useState({}),{inputValue:g,setInputValue:r,debouncedValue:n}=J({initialValue:"",delay:500});d.useEffect(()=>{l(t=>({...t,search:n}))},[n]);const[p,x]=d.useState(0),i=t=>{r(t.target.value)},h=()=>{r(""),l({}),x(t=>t+1)},j=()=>{x(t=>t+1)};return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(Q,{icon:e.jsx(D,{size:40,strokeWidth:1.5}),title:"Procedencias",description:"Gestión de lugares de procedencia de los productos.",action:{label:"Agregar Procedencia",icon:e.jsx(se,{className:"h-4 w-4"}),onClick:()=>u("/basic/procedencias/add")}}),e.jsx(X,{title:"Filtros de Búsqueda",description:"Busca procedencias por nombre o código.",icon:e.jsx(ae,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:h,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(Y,{value:g,onChange:i,placeholder:"Buscar por nombre o código...",debouncedValue:n,inputProps:{id:"search"}})]})})}),e.jsx(Z,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(ee,{className:"p-0",children:e.jsx(ie,{filters:m,onDelete:j},p)})})]})}export{Ce as default};

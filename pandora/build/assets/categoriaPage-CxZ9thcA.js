import{p as O,q as $,r as l,j as e}from"./index-CuM1UVNz.js";import{u as L,a as M}from"./categoriaService-DLty_uvx.js";import{u as R,P as H,F as G,S as W}from"./SearchInput-CDkOK910.js";import{B as p}from"./button-DvvEsyKI.js";import{B as v}from"./badge-D5I9DsW8.js";import{D as J,a as K,b as Q,c as U,d as X,e as Y}from"./dialog-DY3vMJng.js";import{S as C,a as S,b as D,c as E,d as t}from"./select-BYbUwerd.js";import{D as Z,A as ee}from"./ActionButtons-CaN9juX7.js";import{P as ae}from"./plus-6cwyY5hA.js";import{B as V}from"./book-open-Cmadd7BL.js";import{F as se}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./card-D4d4qW_8.js";import"./input-ZDudQbKj.js";import"./Combination-CQ9AiL49.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";import"./table-B6Cf0HfV.js";import"./tooltip-MLxQ3M63.js";import"./eye-DnbWXCAI.js";import"./file-pen-CTd16QCS.js";import"./trash-2-BwIRBH_r.js";function Pe(){const o=O(),{toast:m}=$(),[r,c]=l.useState({is_active:void 0,level:void 0}),[P,n]=l.useState(!1),[i,j]=l.useState(null),[b,u]=l.useState(1),h=10,{inputValue:F,setInputValue:f,debouncedValue:d}=R({initialValue:"",delay:500});l.useEffect(()=>{u(1),c(a=>({...a,search:d}))},[d]),l.useEffect(()=>{Object.entries(r).some(([q,z])=>q!=="search"&&z!==void 0)&&u(1)},[r]);const{data:s,isLoading:y,isError:B,error:g,refetch:N}=L({...r,search:d,page:b,page_size:h},{keepPreviousData:!0,onError:a=>{m({title:"Error al cargar datos",description:`No se pudieron cargar las categorías: ${a.message}`,variant:"destructive"})}}),x=M({onSuccess:()=>{m({title:"Categoría eliminada",description:i?`La categoría "${i.nombre}" ha sido eliminada correctamente.`:"La categoría ha sido eliminada correctamente."})},onError:a=>{m({title:"Error al eliminar",description:`No se pudo eliminar la categoría: ${a.message}`,variant:"destructive"})}}),k=a=>{f(a.target.value)},A=a=>{c({...r,is_active:a==="all"?void 0:a==="true"})},T=a=>{c({...r,level:a==="all"?void 0:parseInt(a)})},I=a=>{j(a),n(!0)},w=()=>{x.mutate(i.id,{onSettled:()=>{n(!1),j(null),N()}})},_=[{header:"Nombre",accessor:"nombre",cell:a=>e.jsxs("div",{className:"font-medium flex items-center text-gray-800",children:[e.jsx(V,{className:"h-4 w-4 mr-2 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:a.nombre,children:a.nombre})]})},{header:"Código",accessor:"code",cell:a=>e.jsx(v,{variant:"outline",className:"font-mono bg-blue-50 text-blue-800 border-blue-200",children:a.code||"N/A"})},{header:"Nivel",accessor:"level",cell:a=>e.jsx("span",{className:"text-gray-700",children:a.level})},{header:"Ruta",accessor:"path",cell:a=>e.jsx("span",{className:"text-xs font-mono bg-muted p-1 rounded",children:a.path})},{header:"Estado",accessor:"is_active",cell:a=>a.is_active?e.jsx(v,{className:"bg-green-500 hover:bg-green-600",children:"Activo"}):e.jsx(v,{variant:"secondary",children:"Inactivo"})},{header:"Acciones",accessor:"id",style:{textAlign:"center",width:"7rem"},cell:a=>e.jsx(ee,{onView:()=>o(`/basic/categorias/${a.id}`),onEdit:()=>o(`/basic/categorias/edit/${a.id}`),onDelete:()=>I(a)})}];return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(H,{icon:e.jsx(V,{size:40,strokeWidth:1.5}),title:"Gestión de Categorías",description:"Administra las categorías para clasificar productos y servicios.",action:{label:"Agregar Categoría",icon:e.jsx(ae,{className:"h-4 w-4"}),onClick:()=>o("/basic/categorias/add")}}),e.jsx(G,{title:"Filtros de Búsqueda",description:"Busca categorías por nombre, código, nivel o estado.",icon:e.jsx(se,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:()=>{f(""),c({is_active:void 0,level:void 0})},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(W,{value:F,onChange:k,placeholder:"Buscar por nombre o código...",debouncedValue:d,inputProps:{id:"search"}})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"status",className:"text-sm font-medium",children:"Estado"}),e.jsxs(C,{onValueChange:A,defaultValue:"all",children:[e.jsx(S,{id:"status",className:"h-9 border-blue-200 focus:border-blue-400",children:e.jsx(D,{placeholder:"Todos los estados"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"Todos"}),e.jsx(t,{value:"true",children:"Activo"}),e.jsx(t,{value:"false",children:"Inactivo"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"level",className:"text-sm font-medium",children:"Nivel"}),e.jsxs(C,{onValueChange:T,defaultValue:"all",children:[e.jsx(S,{id:"level",className:"h-9 border-blue-200 focus:border-blue-400",children:e.jsx(D,{placeholder:"Todos los niveles"})}),e.jsxs(E,{children:[e.jsx(t,{value:"all",children:"Todos"}),e.jsx(t,{value:"0",children:"Nivel 0 (Raíz)"}),e.jsx(t,{value:"1",children:"Nivel 1"}),e.jsx(t,{value:"2",children:"Nivel 2"}),e.jsx(t,{value:"3",children:"Nivel 3"})]})]})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(p,{variant:"outline",size:"sm",onClick:()=>o("/basic/categorias/infinite"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Ver con paginación infinita"})}),e.jsx(Z,{columns:_,data:s==null?void 0:s.results,isLoading:y,isError:B,errorMessage:g==null?void 0:g.message,onRetry:N,emptyMessage:"No se encontraron categorías que coincidan con la búsqueda.",pagination:{currentPage:b,totalPages:Math.ceil(((s==null?void 0:s.count)||0)/h),totalItems:(s==null?void 0:s.count)||0,pageSize:h,onPageChange:u}}),e.jsx(J,{open:P,onOpenChange:n,children:e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Confirmar eliminación"}),e.jsxs(X,{children:['¿Estás seguro de que deseas eliminar la categoría "',i==null?void 0:i.nombre,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(Y,{children:[e.jsx(p,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(p,{variant:"destructive",onClick:w,disabled:x.isPending,children:x.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{Pe as default};

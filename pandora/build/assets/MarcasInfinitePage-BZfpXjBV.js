import{p as _,r as h,j as e,q as B}from"./index-CuM1UVNz.js";import{e as z,a as L}from"./marcaService-DsNCAPSw.js";import{B as t}from"./button-DvvEsyKI.js";import{B as F}from"./badge-D5I9DsW8.js";import{C as N,a as $,b as O,d as q,c as C,e as H}from"./card-D4d4qW_8.js";import{D as R,a as G,b as U,c as W,d as J,e as K}from"./dialog-DY3vMJng.js";import{G as Q}from"./globe-FYGSDlcS.js";import{E as X}from"./external-link-RXsHBssH.js";import{E as Y}from"./eye-DnbWXCAI.js";import{F as Z}from"./file-pen-CTd16QCS.js";import{T as ee}from"./trash-2-BwIRBH_r.js";import{u as se,P as re,F as ae,S as le}from"./SearchInput-CDkOK910.js";import{S as I,a as M,b as P,c as T,d as f}from"./select-BYbUwerd.js";import{P as te}from"./plus-6cwyY5hA.js";import{A as ie}from"./award-Bv_wBtov.js";import{A as ne}from"./arrow-left-EuUX28YT.js";import{F as oe}from"./funnel-DTkdRWcb.js";import"./axios-CTonWHPK.js";import"./useInfiniteQuery-Ci5GnK52.js";import"./Combination-CQ9AiL49.js";import"./input-ZDudQbKj.js";import"./index-BmPRlYq_.js";import"./index-CkfEdLBp.js";import"./index-BGi3wog7.js";function ce({marcas:x=[],onLoadMore:o,hasNextPage:g,isFetchingNextPage:l,onDelete:b,isDeletePending:p=!1}){const i=_(),[a,c]=h.useState(!1),[n,d]=h.useState(null),m=h.useRef(),w=h.useCallback(s=>{l||(m.current&&m.current.disconnect(),m.current=new IntersectionObserver(u=>{u[0].isIntersecting&&g&&o()}),s&&m.current.observe(s))},[l,g,o]),y=s=>s?s.replace(/^https?:\/\//i,""):null,E=s=>{d(s),c(!0)},v=()=>{b&&n&&b(n.id,{onSettled:()=>{c(!1),d(null)}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map((s,u)=>{const S=u===x.length-1;return e.jsxs(N,{className:"overflow-hidden",ref:S?w:null,children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(O,{className:"text-lg truncate",title:s.nombre,children:s.nombre}),s.is_active?e.jsx(F,{className:"bg-green-500",children:"Activo"}):e.jsx(F,{variant:"secondary",children:"Inactivo"})]}),s.country_origin&&e.jsx(q,{children:e.jsx("span",{children:s.country_origin})})]}),e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Código:"}),e.jsx("span",{className:"ml-2 text-sm font-mono",children:s.code})]}),s.website&&e.jsx("div",{children:e.jsxs("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:underline",children:[e.jsx(Q,{className:"mr-1 h-3 w-3"}),y(s.website),e.jsx(X,{className:"ml-1 h-3 w-3"})]})}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2",title:s.description,children:s.description})]})}),e.jsxs(H,{className:"border-t bg-muted/50 flex justify-between",children:[e.jsx("div",{children:s.proveedores&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prov: ",s.proveedores.length>15?s.proveedores.substring(0,15)+"...":s.proveedores]})}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>i(`/basic/marcas/${s.id}`),title:"Ver detalles",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>i(`/basic/marcas/edit/${s.id}`),title:"Editar",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>E(s),title:"Eliminar",className:"text-destructive hover:bg-destructive/10",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]},`${s.id}-${u}`)})}),l&&e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"})}),e.jsx(R,{open:a,onOpenChange:c,children:e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(W,{children:"Confirmar eliminación"}),e.jsxs(J,{children:['¿Estás seguro de que deseas eliminar la marca "',n==null?void 0:n.nombre,'"? Esta acción no se puede deshacer.']})]}),e.jsxs(K,{children:[e.jsx(t,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:v,disabled:p,children:p?"Eliminando...":"Eliminar"})]})]})})]})}function Te(){var k;const x=_(),{toast:o}=B(),[g,l]=h.useState({}),{inputValue:b,setInputValue:p,debouncedValue:i}=se({initialValue:"",delay:500});h.useEffect(()=>{l(r=>({...r,search:i}))},[i]);const{data:a,isLoading:c,isError:n,error:d,fetchNextPage:m,hasNextPage:w,isFetchingNextPage:y,refetch:E}=z({...g,search:i,page_size:12},{onError:r=>{o({title:"Error al cargar datos",description:`No se pudieron cargar las marcas: ${r.message}`,variant:"destructive"})}}),v=L({onSuccess:r=>{o({title:"Marca eliminada",description:"La marca ha sido eliminada correctamente."})},onError:r=>{o({title:"Error al eliminar",description:`No se pudo eliminar la marca: ${r.message}`,variant:"destructive"})}}),s=r=>{p(r.target.value)},u=r=>{l(j=>({...j,is_active:r==="all"?void 0:r==="true"}))},S=r=>{l(j=>({...j,country_origin:r==="all"?void 0:r}))},D=()=>{p(""),l({})},V=(a==null?void 0:a.pages.flatMap(r=>r.results))||[],A=(k=a==null?void 0:a.pages[0])!=null&&k.results?Array.from(new Set(a.pages[0].results.filter(r=>r.country_origin).map(r=>r.country_origin))).sort():[];return e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsx(re,{icon:e.jsx(ie,{size:40,strokeWidth:1.5}),title:"Marcas con Scroll Infinito",description:"Visualiza las marcas con paginación dinámica al hacer scroll.",action:{label:"Agregar Marca",icon:e.jsx(te,{className:"h-4 w-4"}),onClick:()=>x("/basic/marcas/add")}}),e.jsx("div",{className:"mb-4",children:e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>x("/basic/marcas"),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Volver a vista estándar"]})}),e.jsx(ae,{title:"Filtros de Búsqueda",description:"Busca marcas por nombre, código, país o estado.",icon:e.jsx(oe,{className:"mr-2 h-5 w-5 text-blue-600"}),onClear:D,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Buscar"}),e.jsx(le,{value:b,onChange:s,placeholder:"Buscar por nombre o código...",debouncedValue:i,inputProps:{id:"search"}})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"status",className:"text-sm font-medium",children:"Estado"}),e.jsxs(I,{onValueChange:u,defaultValue:"all",children:[e.jsx(M,{id:"status",className:"border-blue-200 focus:border-blue-400",children:e.jsx(P,{placeholder:"Todos los estados"})}),e.jsxs(T,{children:[e.jsx(f,{value:"all",children:"Todos"}),e.jsx(f,{value:"true",children:"Activo"}),e.jsx(f,{value:"false",children:"Inactivo"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("label",{htmlFor:"country",className:"text-sm font-medium",children:"País de origen"}),e.jsxs(I,{onValueChange:S,defaultValue:"all",children:[e.jsx(M,{id:"country",className:"border-blue-200 focus:border-blue-400",children:e.jsx(P,{placeholder:"Todos los países"})}),e.jsxs(T,{children:[e.jsx(f,{value:"all",children:"Todos"}),A.map(r=>e.jsx(f,{value:r,children:r},r))]})]})]})]})}),c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):n?e.jsx(N,{className:"border-destructive bg-red-50 shadow-md",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Error al cargar datos"}),e.jsx("p",{className:"text-red-600",children:(d==null?void 0:d.message)||"Error desconocido"}),e.jsx(t,{onClick:()=>E(),variant:"outline",className:"border-red-200 text-red-700 hover:bg-red-50",children:"Intentar nuevamente"})]})})}):V.length===0?e.jsx(N,{className:"border-blue-100 shadow-md",children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"mb-4 text-lg text-blue-800",children:"No se encontraron marcas con los filtros seleccionados"}),e.jsx(t,{variant:"outline",onClick:D,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Limpiar filtros"})]})}):e.jsx(N,{className:"border-blue-100 shadow-md overflow-hidden",children:e.jsx(C,{className:"p-0",children:e.jsx(ce,{marcas:V,onLoadMore:m,hasNextPage:w,isFetchingNextPage:y,onDelete:(r,j)=>v.mutate(r,j),isDeletePending:v.isPending})})})]})}export{Te as default};
